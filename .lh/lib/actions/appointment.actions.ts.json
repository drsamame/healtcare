{
    "sourceFile": "lib/actions/appointment.actions.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 69,
            "patches": [
                {
                    "date": 1724111190276,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1724111266113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n \t\t}\r\n-\t\tconst { id } = await db.patients.create({\r\n+\t\tconst { id } = await db.appointment.create({\r\n \t\t\tdata,\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n \t} catch (error) {\r\n"
                },
                {
                    "date": 1724111577591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,9 @@\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n \t\t}\r\n+\t\tconsole.log(data)\r\n \t\tconst { id } = await db.appointment.create({\r\n \t\t\tdata,\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n"
                },
                {
                    "date": 1724112461445,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,9 @@\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n \ttry {\r\n \t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data);\r\n+\t\tconsole.log(data, 'data');\r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n"
                },
                {
                    "date": 1724112617935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,10 @@\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n \ttry {\r\n \t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data, 'data');\r\n+\t\tconsole.log(data);\r\n+\t\tconsole.log(appointmentData)\r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n"
                },
                {
                    "date": 1724112701651,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,138 @@\n+'use server';\r\n+\r\n+import { ID, Query } from 'node-appwrite';\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { formatDateTime, parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n+\t\tconsole.log(data);\r\n+\t\tconsole.log(appointmentData)\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconsole.log(data)\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\t...data,\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await databases.listDocuments(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\t[Query.orderDesc('$createdAt')]\r\n+\t\t);\r\n+\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\r\n+\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n+\t\t\t(acc, appointment) => {\r\n+\t\t\t\tswitch (appointment.status) {\r\n+\t\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'pending':\r\n+\t\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t}\r\n+\t\t\t\treturn acc;\r\n+\t\t\t},\r\n+\t\t\tinitialCounts\r\n+\t\t);\r\n+\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.total,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments: appointments.documents,\r\n+\t\t};\r\n+\r\n+\t\treturn parseStringify(data);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the recent appointments:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724112845511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,139 @@\n+'use server';\r\n+\r\n+import { ID, Query } from 'node-appwrite';\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { formatDateTime, parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n+\t\tconsole.log(data);\r\n+\t\tconsole.log(appointmentData)\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconsole.log(data)\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\t...data,\r\n+\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await databases.listDocuments(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\t[Query.orderDesc('$createdAt')]\r\n+\t\t);\r\n+\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\r\n+\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n+\t\t\t(acc, appointment) => {\r\n+\t\t\t\tswitch (appointment.status) {\r\n+\t\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'pending':\r\n+\t\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t}\r\n+\t\t\t\treturn acc;\r\n+\t\t\t},\r\n+\t\t\tinitialCounts\r\n+\t\t);\r\n+\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.total,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments: appointments.documents,\r\n+\t\t};\r\n+\r\n+\t\treturn parseStringify(data);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the recent appointments:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724113063750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,144 @@\n+'use server';\r\n+\r\n+import { ID, Query } from 'node-appwrite';\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { formatDateTime, parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n+\t\tconsole.log(data);\r\n+\t\tconsole.log(appointmentData)\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconsole.log(data)\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t\t\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await databases.listDocuments(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\t[Query.orderDesc('$createdAt')]\r\n+\t\t);\r\n+\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\r\n+\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n+\t\t\t(acc, appointment) => {\r\n+\t\t\t\tswitch (appointment.status) {\r\n+\t\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'pending':\r\n+\t\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t}\r\n+\t\t\t\treturn acc;\r\n+\t\t\t},\r\n+\t\t\tinitialCounts\r\n+\t\t);\r\n+\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.total,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments: appointments.documents,\r\n+\t\t};\r\n+\r\n+\t\treturn parseStringify(data);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the recent appointments:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724281064618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,14 @@\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n \ttry {\r\n \t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data);\r\n-\t\tconsole.log(appointmentData)\r\n+\r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n \t\t}\r\n-\t\tconsole.log(data)\r\n \t\tconst { id } = await db.appointment.create({\r\n \t\t\tdata: {\r\n \t\t\t\t...data,\r\n \t\t\t\tuserId: appointmentData.userId,\r\n@@ -64,45 +62,41 @@\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n \ttry {\r\n-\t\tconst appointments = await databases.listDocuments(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\t[Query.orderDesc('$createdAt')]\r\n-\t\t);\r\n-\r\n+\t\tconst appointments = await db.appointment.findMany()\r\n+\t\tconsole.log(appointments);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n \t\t};\r\n \r\n-\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t\t(acc, appointment) => {\r\n-\t\t\t\tswitch (appointment.status) {\r\n-\t\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'pending':\r\n-\t\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t}\r\n-\t\t\t\treturn acc;\r\n-\t\t\t},\r\n-\t\t\tinitialCounts\r\n-\t\t);\r\n+\t\t// const counts = (appointments.documents as Appointment[]).reduce(\r\n+\t\t// \t(acc, appointment) => {\r\n+\t\t// \t\tswitch (appointment.status) {\r\n+\t\t// \t\t\tcase 'scheduled':\r\n+\t\t// \t\t\t\tacc.scheduledCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t\tcase 'pending':\r\n+\t\t// \t\t\t\tacc.pendingCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t\tcase 'cancelled':\r\n+\t\t// \t\t\t\tacc.cancelledCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t}\r\n+\t\t// \t\treturn acc;\r\n+\t\t// \t},\r\n+\t\t// \tinitialCounts\r\n+\t\t// );\r\n \r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.total,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments: appointments.documents,\r\n-\t\t};\r\n+\t\t// const data = {\r\n+\t\t// \ttotalCount: appointments.total,\r\n+\t\t// \t...counts,\r\n+\t\t// \tdocuments: appointments.documents,\r\n+\t\t// };\r\n \r\n-\t\treturn parseStringify(data);\r\n+\t\t// return parseStringify(data);\r\n \t} catch (error) {\r\n \t\tconsole.error(\r\n \t\t\t'An error occurred while retrieving the recent appointments:',\r\n \t\t\terror\r\n@@ -141,419 +135,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { ID, Query } from 'node-appwrite';\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { formatDateTime, parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data);\r\n-\t\tconsole.log(appointmentData)\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconsole.log(data)\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\t...data,\r\n-\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await databases.listDocuments(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\t[Query.orderDesc('$createdAt')]\r\n-\t\t);\r\n-\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\r\n-\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t\t(acc, appointment) => {\r\n-\t\t\t\tswitch (appointment.status) {\r\n-\t\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'pending':\r\n-\t\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t}\r\n-\t\t\t\treturn acc;\r\n-\t\t\t},\r\n-\t\t\tinitialCounts\r\n-\t\t);\r\n-\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.total,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments: appointments.documents,\r\n-\t\t};\r\n-\r\n-\t\treturn parseStringify(data);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the recent appointments:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { ID, Query } from 'node-appwrite';\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { formatDateTime, parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data);\r\n-\t\tconsole.log(appointmentData)\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconsole.log(data)\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\t...data,\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await databases.listDocuments(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\t[Query.orderDesc('$createdAt')]\r\n-\t\t);\r\n-\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\r\n-\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t\t(acc, appointment) => {\r\n-\t\t\t\tswitch (appointment.status) {\r\n-\t\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'pending':\r\n-\t\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t}\r\n-\t\t\t\treturn acc;\r\n-\t\t\t},\r\n-\t\t\tinitialCounts\r\n-\t\t);\r\n-\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.total,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments: appointments.documents,\r\n-\t\t};\r\n-\r\n-\t\treturn parseStringify(data);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the recent appointments:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { ID, Query } from 'node-appwrite';\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { formatDateTime, parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\t\tconsole.log(data);\r\n-\t\tconsole.log(appointmentData)\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconsole.log(data)\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata,\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await databases.listDocuments(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\t[Query.orderDesc('$createdAt')]\r\n-\t\t);\r\n-\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\r\n-\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t\t(acc, appointment) => {\r\n-\t\t\t\tswitch (appointment.status) {\r\n-\t\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'pending':\r\n-\t\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t}\r\n-\t\t\t\treturn acc;\r\n-\t\t\t},\r\n-\t\t\tinitialCounts\r\n-\t\t);\r\n-\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.total,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments: appointments.documents,\r\n-\t\t};\r\n-\r\n-\t\treturn parseStringify(data);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the recent appointments:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724281170895,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,138 @@\n+'use server';\r\n+\r\n+import { ID, Query } from 'node-appwrite';\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { formatDateTime, parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t\t\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany()\r\n+\t\tconsole.log(appointments);\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\r\n+\t\t// const counts = (appointments.documents as Appointment[]).reduce(\r\n+\t\t// \t(acc, appointment) => {\r\n+\t\t// \t\tswitch (appointment.status) {\r\n+\t\t// \t\t\tcase 'scheduled':\r\n+\t\t// \t\t\t\tacc.scheduledCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t\tcase 'pending':\r\n+\t\t// \t\t\t\tacc.pendingCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t\tcase 'cancelled':\r\n+\t\t// \t\t\t\tacc.cancelledCount++;\r\n+\t\t// \t\t\t\tbreak;\r\n+\t\t// \t\t}\r\n+\t\t// \t\treturn acc;\r\n+\t\t// \t},\r\n+\t\t// \tinitialCounts\r\n+\t\t// );\r\n+\r\n+\t\t// const data = {\r\n+\t\t// \ttotalCount: appointments.total,\r\n+\t\t// \t...counts,\r\n+\t\t// \tdocuments: appointments.documents,\r\n+\t\t// };\r\n+\r\n+\t\t// return parseStringify(data);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the recent appointments:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724281175951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,142 +135,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { ID, Query } from 'node-appwrite';\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { formatDateTime, parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t\t\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany()\r\n-\t\tconsole.log(appointments);\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\r\n-\t\t// const counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t// \t(acc, appointment) => {\r\n-\t\t// \t\tswitch (appointment.status) {\r\n-\t\t// \t\t\tcase 'scheduled':\r\n-\t\t// \t\t\t\tacc.scheduledCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t\tcase 'pending':\r\n-\t\t// \t\t\t\tacc.pendingCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t\tcase 'cancelled':\r\n-\t\t// \t\t\t\tacc.cancelledCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t}\r\n-\t\t// \t\treturn acc;\r\n-\t\t// \t},\r\n-\t\t// \tinitialCounts\r\n-\t\t// );\r\n-\r\n-\t\t// const data = {\r\n-\t\t// \ttotalCount: appointments.total,\r\n-\t\t// \t...counts,\r\n-\t\t// \tdocuments: appointments.documents,\r\n-\t\t// };\r\n-\r\n-\t\t// return parseStringify(data);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the recent appointments:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724282427849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,9 +15,10 @@\n export const createAppointment = async (\r\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n \ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n \r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n@@ -28,9 +29,8 @@\n \t\t\t\t...data,\r\n \t\t\t\tuserId: appointmentData.userId,\r\n \t\t\t\tpatientId: appointmentData.patient,\r\n \t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t\t\r\n \t\t\t},\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n \t} catch (error) {\r\n@@ -62,46 +62,46 @@\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n \ttry {\r\n-\t\tconst appointments = await db.appointment.findMany()\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\t_count: true\r\n+\t\t});\r\n \t\tconsole.log(appointments);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n \t\t};\r\n-\r\n-\t\t// const counts = (appointments.documents as Appointment[]).reduce(\r\n-\t\t// \t(acc, appointment) => {\r\n-\t\t// \t\tswitch (appointment.status) {\r\n-\t\t// \t\t\tcase 'scheduled':\r\n-\t\t// \t\t\t\tacc.scheduledCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t\tcase 'pending':\r\n-\t\t// \t\t\t\tacc.pendingCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t\tcase 'cancelled':\r\n-\t\t// \t\t\t\tacc.cancelledCount++;\r\n-\t\t// \t\t\t\tbreak;\r\n-\t\t// \t\t}\r\n-\t\t// \t\treturn acc;\r\n-\t\t// \t},\r\n-\t\t// \tinitialCounts\r\n-\t\t// );\r\n-\r\n-\t\t// const data = {\r\n-\t\t// \ttotalCount: appointments.total,\r\n-\t\t// \t...counts,\r\n-\t\t// \tdocuments: appointments.documents,\r\n-\t\t// };\r\n-\r\n-\t\t// return parseStringify(data);\r\n+\t\tconst counts = (appointments).reduce(\r\n+\t\t\t(acc, appointment) => {\r\n+\t\t\t\tswitch (appointment.status) {\r\n+\t\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'pending':\r\n+\t\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\t\tbreak;\r\n+\t\t\t\t}\r\n+\t\t\t\treturn acc;\r\n+\t\t\t},\r\n+\t\t\tinitialCounts\r\n+\t\t);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.total,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments: appointments.documents,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n \t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the recent appointments:',\r\n-\t\t\terror\r\n-\t\t);\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n export const updateAppointment = async ({\r\n"
                },
                {
                    "date": 1724282660714,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,39 +62,38 @@\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n \ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\t_count: true\r\n-\t\t});\r\n-\t\tconsole.log(appointments);\r\n+\t\tconst appointments = await db.appointment.findMany();\r\n+\t\tconst [data, count] = await db.$transaction([\r\n+\t\t\tdb.appointment.findMany(),\r\n+\t\t\tdb.appointment.count(),\r\n+\t\t]);\r\n+\t\tconsole.log(data, count);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n \t\t};\r\n-\t\tconst counts = (appointments).reduce(\r\n-\t\t\t(acc, appointment) => {\r\n-\t\t\t\tswitch (appointment.status) {\r\n-\t\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'pending':\r\n-\t\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\t\tbreak;\r\n-\t\t\t\t}\r\n-\t\t\t\treturn acc;\r\n-\t\t\t},\r\n-\t\t\tinitialCounts\r\n-\t\t);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.total,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments: appointments.documents,\r\n-\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\t// const data = {\r\n+\t\t// \ttotalCount: appointments.total,\r\n+\t\t// \t...counts,\r\n+\t\t// \tdocuments: appointments.documents,\r\n+\t\t// };\r\n \t\treturn { success: true, data };\r\n \t} catch (error) {\r\n \t\tconsole.log(error);\r\n \t\tif (error instanceof AuthError) {\r\n"
                },
                {
                    "date": 1724283649956,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,19 +63,19 @@\n \r\n export const getRecentAppointmentList = async () => {\r\n \ttry {\r\n \t\tconst appointments = await db.appointment.findMany();\r\n-\t\tconst [data, count] = await db.$transaction([\r\n+\t\tconst [documents, count] = await db.$transaction([\r\n \t\t\tdb.appointment.findMany(),\r\n \t\t\tdb.appointment.count(),\r\n \t\t]);\r\n-\t\tconsole.log(data, count);\r\n+\t\tconsole.log(appointments, count);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n \t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\tconst counts = documents.reduce((acc, appointment) => {\r\n \t\t\tswitch (appointment.status) {\r\n \t\t\t\tcase 'scheduled':\r\n \t\t\t\t\tacc.scheduledCount++;\r\n \t\t\t\t\tbreak;\r\n@@ -87,13 +87,13 @@\n \t\t\t\t\tbreak;\r\n \t\t\t}\r\n \t\t\treturn acc;\r\n \t\t}, initialCounts);\r\n-\t\t// const data = {\r\n-\t\t// \ttotalCount: appointments.total,\r\n-\t\t// \t...counts,\r\n-\t\t// \tdocuments: appointments.documents,\r\n-\t\t// };\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: count,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments,\r\n+\t\t};\r\n \t\treturn { success: true, data };\r\n \t} catch (error) {\r\n \t\tconsole.log(error);\r\n \t\tif (error instanceof AuthError) {\r\n"
                },
                {
                    "date": 1724284346876,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,8 @@\n \t\t\t},\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n \t} catch (error) {\r\n-\t\tconsole.log(error);\r\n \t\tif (error instanceof AuthError) {\r\n \t\t\treturn { error: error.cause?.err?.message };\r\n \t\t}\r\n \t\treturn { error: 'error 500' };\r\n"
                },
                {
                    "date": 1724284372484,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,12 @@\n 'use server';\r\n \r\n-import { ID, Query } from 'node-appwrite';\r\n import {\r\n \tDATABASE_ID,\r\n \tdatabases,\r\n \tAPPOINTMENT_COLLECTION_ID,\r\n } from '../appwite.config';\r\n-import { formatDateTime, parseStringify } from '../utils';\r\n+import { parseStringify } from '../utils';\r\n import { revalidatePath } from 'next/cache';\r\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n import { AuthError } from 'next-auth';\r\n"
                },
                {
                    "date": 1724287136687,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,136 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany();\r\n+\t\tconsole.log(appointments)\r\n+\t\tconst [documents, count] = await db.$transaction([\r\n+\t\t\tdb.appointment.findMany(),\r\n+\t\t\tdb.appointment.count(),\r\n+\t\t]);\r\n+\t\tconsole.log(appointments, count);\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = documents.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: count,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724287153187,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,9 @@\n \t\tconst [documents, count] = await db.$transaction([\r\n \t\t\tdb.appointment.findMany(),\r\n \t\t\tdb.appointment.count(),\r\n \t\t]);\r\n-\t\tconsole.log(appointments, count);\r\n+\t\t// console.log(appointments, count);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n@@ -133,139 +133,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany();\r\n-\t\tconst [documents, count] = await db.$transaction([\r\n-\t\t\tdb.appointment.findMany(),\r\n-\t\t\tdb.appointment.count(),\r\n-\t\t]);\r\n-\t\tconsole.log(appointments, count);\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = documents.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: count,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724287665694,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,140 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t  },\r\n+\t\t});\r\n+\t\tconsole.log(appointments)\r\n+\t\tconst [documents, count] = await db.$transaction([\r\n+\t\t\tdb.appointment.findMany(),\r\n+\t\t\tdb.appointment.count(),\r\n+\t\t]);\r\n+\t\t// console.log(appointments, count);\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = documents.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: count,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724287878928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,140 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\tconsole.log(appointmentId);\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t  },\r\n+\t\t});\r\n+\t\tconsole.log(appointments)\r\n+\t\tconst [documents, count] = await db.$transaction([\r\n+\t\t\tdb.appointment.findMany(),\r\n+\t\t\tdb.appointment.count(),\r\n+\t\t]);\r\n+\t\t// console.log(appointments, count);\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = documents.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: count,\r\n+\t\t\t...counts,\r\n+\t\t\tdocuments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724288067507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,159 +66,16 @@\n \t\t\t\tpatient: true, // All posts where authorId == 20\r\n \t\t\t  },\r\n \t\t});\r\n \t\tconsole.log(appointments)\r\n-\t\tconst [documents, count] = await db.$transaction([\r\n-\t\t\tdb.appointment.findMany(),\r\n-\t\t\tdb.appointment.count(),\r\n-\t\t]);\r\n-\t\t// console.log(appointments, count);\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = documents.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: count,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n \r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t  },\r\n-\t\t});\r\n-\t\tconsole.log(appointments)\r\n-\t\tconst [documents, count] = await db.$transaction([\r\n-\t\t\tdb.appointment.findMany(),\r\n-\t\t\tdb.appointment.count(),\r\n-\t\t]);\r\n \t\t// console.log(appointments, count);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n \t\t};\r\n-\t\tconst counts = documents.reduce((acc, appointment) => {\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n \t\t\tswitch (appointment.status) {\r\n \t\t\t\tcase 'scheduled':\r\n \t\t\t\t\tacc.scheduledCount++;\r\n \t\t\t\t\tbreak;\r\n@@ -231,11 +88,11 @@\n \t\t\t}\r\n \t\t\treturn acc;\r\n \t\t}, initialCounts);\r\n \t\tconst data = {\r\n-\t\t\ttotalCount: count,\r\n+\t\t\ttotalCount: appointments.length,\r\n \t\t\t...counts,\r\n-\t\t\tdocuments,\r\n+\t\t\tappointments,\r\n \t\t};\r\n \t\treturn { success: true, data };\r\n \t} catch (error) {\r\n \t\tconsole.log(error);\r\n@@ -277,140 +134,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany();\r\n-\t\tconsole.log(appointments)\r\n-\t\tconst [documents, count] = await db.$transaction([\r\n-\t\t\tdb.appointment.findMany(),\r\n-\t\t\tdb.appointment.count(),\r\n-\t\t]);\r\n-\t\t// console.log(appointments, count);\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = documents.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: count,\r\n-\t\t\t...counts,\r\n-\t\t\tdocuments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724360552562,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,11 +65,8 @@\n \t\t\tinclude: {\r\n \t\t\t\tpatient: true, // All posts where authorId == 20\r\n \t\t\t  },\r\n \t\t});\r\n-\t\tconsole.log(appointments)\r\n-\r\n-\t\t// console.log(appointments, count);\r\n \t\tconst initialCounts = {\r\n \t\t\tscheduledCount: 0,\r\n \t\t\tpendingCount: 0,\r\n \t\t\tcancelledCount: 0,\r\n"
                },
                {
                    "date": 1724366327652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,134 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t  },\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await databases.updateDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId,\r\n+\t\t\tappointment\r\n+\t\t);\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724399879087,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,131 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724399891352,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,131 @@\n+'use server';\r\n+\r\n+import {\r\n+\tDATABASE_ID,\r\n+\tdatabases,\r\n+\tAPPOINTMENT_COLLECTION_ID,\r\n+} from '../appwite.config';\r\n+import { parseStringify } from '../utils';\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (appointmentId: string) => {\r\n+\ttry {\r\n+\t\tconst appointment = await databases.getDocument(\r\n+\t\t\tDATABASE_ID!,\r\n+\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n+\t\t\tappointmentId\r\n+\t\t);\r\n+\t\tconsole.log(appointment);\r\n+\r\n+\t\treturn parseStringify(appointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error(\r\n+\t\t\t'An error occurred while retrieving the existing patient:',\r\n+\t\t\terror\r\n+\t\t);\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+\ttype,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\tconsole.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn parseStringify(updatedAppointment);\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724400104483,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -103,8 +103,10 @@\n \tappointmentId,\r\n \tappointment,\r\n \ttype,\r\n }: UpdateAppointmentParams) => {\r\n+\tconsole.log(type)\r\n+\tconsole.log(appointment)\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n \t\t\tdata: appointment,\r\n@@ -128,403 +130,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t  },\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (appointmentId: string) => {\r\n-\tconsole.log(appointmentId);\r\n-\ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t  },\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-\ttype,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await databases.updateDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId,\r\n-\t\t\tappointment\r\n-\t\t);\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724400627405,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,14 +106,14 @@\n }: UpdateAppointmentParams) => {\r\n \tconsole.log(type)\r\n \tconsole.log(appointment)\r\n \ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n+\t\t// const updatedAppointment = await db.appointment.update({\r\n+\t\t// \twhere: { id: appointmentId },\r\n+\t\t// \tdata: appointment,\r\n+\t\t// });\r\n \r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\t\t// if (!updatedAppointment) throw new Error('Appointment not found');\r\n \r\n \t\t// const smsMessage = `Greetings from CarePulse. ${\r\n \t\t// \ttype === 'schedule'\r\n \t\t// \t\t? `Your appointment is confirmed for ${\r\n"
                },
                {
                    "date": 1724400771928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,8 +105,9 @@\n \ttype,\r\n }: UpdateAppointmentParams) => {\r\n \tconsole.log(type)\r\n \tconsole.log(appointment)\r\n+\tconsole.log(appointmentId)\r\n \ttry {\r\n \t\t// const updatedAppointment = await db.appointment.update({\r\n \t\t// \twhere: { id: appointmentId },\r\n \t\t// \tdata: appointment,\r\n"
                },
                {
                    "date": 1724401853609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,14 +107,14 @@\n \tconsole.log(type)\r\n \tconsole.log(appointment)\r\n \tconsole.log(appointmentId)\r\n \ttry {\r\n-\t\t// const updatedAppointment = await db.appointment.update({\r\n-\t\t// \twhere: { id: appointmentId },\r\n-\t\t// \tdata: appointment,\r\n-\t\t// });\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n \r\n-\t\t// if (!updatedAppointment) throw new Error('Appointment not found');\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n \r\n \t\t// const smsMessage = `Greetings from CarePulse. ${\r\n \t\t// \ttype === 'schedule'\r\n \t\t// \t\t? `Your appointment is confirmed for ${\r\n@@ -124,11 +124,11 @@\n \t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n \t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n \t\t// }.`;\r\n \t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\tconsole.log(updatedAppointment)\r\n+\t\t// console.log(updatedAppointment)\r\n \t\trevalidatePath('/admin');\r\n-\t\treturn parseStringify(updatedAppointment);\r\n+\t\treturn updatedAppointment;\r\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n"
                },
                {
                    "date": 1724476292406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,23 +39,27 @@\n \t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n-export const getAppointment = async (appointmentId: string) => {\r\n+export const getAppointment = async (id: string) => {\r\n \ttry {\r\n-\t\tconst appointment = await databases.getDocument(\r\n-\t\t\tDATABASE_ID!,\r\n-\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n-\t\t\tappointmentId\r\n-\t\t);\r\n-\t\tconsole.log(appointment);\r\n-\r\n-\t\treturn parseStringify(appointment);\r\n-\t} catch (error) {\r\n-\t\tconsole.error(\r\n-\t\t\t'An error occurred while retrieving the existing patient:',\r\n-\t\t\terror\r\n-\t\t);\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tuserId: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n"
                },
                {
                    "date": 1724476339239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,9 +43,9 @@\n export const getAppointment = async (id: string) => {\r\n \ttry {\r\n \t\tconst patient = await db.appointment.findFirst({\r\n \t\t\twhere: {\r\n-\t\t\t\tuserId: id,\r\n+\t\t\t\tid: id,\r\n \t\t\t},\r\n \t\t\tselect: {\r\n \t\t\t\tid: true,\r\n \t\t\t},\r\n@@ -107,11 +107,8 @@\n \tappointmentId,\r\n \tappointment,\r\n \ttype,\r\n }: UpdateAppointmentParams) => {\r\n-\tconsole.log(type)\r\n-\tconsole.log(appointment)\r\n-\tconsole.log(appointmentId)\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n \t\t\tdata: appointment,\r\n"
                },
                {
                    "date": 1724476487513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,6 @@\n 'use server';\r\n \r\n-import {\r\n-\tDATABASE_ID,\r\n-\tdatabases,\r\n-\tAPPOINTMENT_COLLECTION_ID,\r\n-} from '../appwite.config';\r\n-import { parseStringify } from '../utils';\r\n import { revalidatePath } from 'next/cache';\r\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n import { AuthError } from 'next-auth';\r\n@@ -47,8 +41,10 @@\n \t\t\t\tid: id,\r\n \t\t\t},\r\n \t\t\tselect: {\r\n \t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n \t\t\t},\r\n \t\t});\r\n \t\tif (!patient) return { error: 'Patient not found' };\r\n \t\treturn {\r\n"
                },
                {
                    "date": 1724480257399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,9 +101,8 @@\n \r\n export const updateAppointment = async ({\r\n \tappointmentId,\r\n \tappointment,\r\n-\ttype,\r\n }: UpdateAppointmentParams) => {\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n"
                },
                {
                    "date": 1724489187630,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,8 +102,9 @@\n export const updateAppointment = async ({\r\n \tappointmentId,\r\n \tappointment,\r\n }: UpdateAppointmentParams) => {\r\n+\tconsole.log('se loqueo la tabla')\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n \t\t\tdata: appointment,\r\n"
                },
                {
                    "date": 1724490134100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,8 +60,13 @@\n \r\n export const getRecentAppointmentList = async () => {\r\n \ttry {\r\n \t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n \t\t\tinclude: {\r\n \t\t\t\tpatient: true, // All posts where authorId == 20\r\n \t\t\t},\r\n \t\t});\r\n@@ -102,14 +107,15 @@\n export const updateAppointment = async ({\r\n \tappointmentId,\r\n \tappointment,\r\n }: UpdateAppointmentParams) => {\r\n-\tconsole.log('se loqueo la tabla')\r\n+\tconsole.log('se loqueo la tabla');\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n \t\t\tdata: appointment,\r\n \t\t});\r\n+\t\tconsole.log(updatedAppointment);\r\n \r\n \t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n \r\n \t\t// const smsMessage = `Greetings from CarePulse. ${\r\n"
                },
                {
                    "date": 1724781397881,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,15 +107,13 @@\n export const updateAppointment = async ({\r\n \tappointmentId,\r\n \tappointment,\r\n }: UpdateAppointmentParams) => {\r\n-\tconsole.log('se loqueo la tabla');\r\n \ttry {\r\n \t\tconst updatedAppointment = await db.appointment.update({\r\n \t\t\twhere: { id: appointmentId },\r\n \t\t\tdata: appointment,\r\n \t\t});\r\n-\t\tconsole.log(updatedAppointment);\r\n \r\n \t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n \r\n \t\t// const smsMessage = `Greetings from CarePulse. ${\r\n"
                },
                {
                    "date": 1724785432673,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import { revalidatePath } from 'next/cache';\r\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n import { AuthError } from 'next-auth';\r\n+import { auth } from \"@/auth\"\r\n \r\n export const createAppointment = async (\r\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n@@ -58,8 +59,16 @@\n \t}\r\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth()\r\n+\tconsole.log(session)\r\n+\tconst userRole = session?.user?.role\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t   error: \"Unauthorize\"\r\n+\t\t}\r\n+\t  }\r\n \ttry {\r\n \t\tconst appointments = await db.appointment.findMany({\r\n \t\t\torderBy: [\r\n \t\t\t\t{\r\n"
                },
                {
                    "date": 1724786710876,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,145 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+import { auth } from \"@/auth\"\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth()\r\n+\tconsole.log(session)\r\n+\tconst userRole = session?.user?.role\r\n+\tconsole.log(userRole)\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t   error: \"Unauthorize\"\r\n+\t\t}\r\n+\t  }\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724786727312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,9 +62,8 @@\n export const getRecentAppointmentList = async () => {\r\n \tconst session = await auth()\r\n \tconsole.log(session)\r\n \tconst userRole = session?.user?.role\r\n-\tconsole.log(userRole)\r\n \tif (userRole !== 'admin') {\r\n \t\treturn {\r\n \t\t   error: \"Unauthorize\"\r\n \t\t}\r\n@@ -142,148 +141,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-import { auth } from \"@/auth\"\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth()\r\n-\tconsole.log(session)\r\n-\tconst userRole = session?.user?.role\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t   error: \"Unauthorize\"\r\n-\t\t}\r\n-\t  }\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724786838947,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { revalidatePath } from 'next/cache';\r\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n import { AuthError } from 'next-auth';\r\n-import { auth } from \"@/auth\"\r\n+import { auth } from '@/auth';\r\n \r\n export const createAppointment = async (\r\n \tappointmentData: CreateAppointmentParams\r\n ) => {\r\n@@ -59,16 +59,15 @@\n \t}\r\n };\r\n \r\n export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth()\r\n-\tconsole.log(session)\r\n-\tconst userRole = session?.user?.role\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n \tif (userRole !== 'admin') {\r\n \t\treturn {\r\n-\t\t   error: \"Unauthorize\"\r\n-\t\t}\r\n-\t  }\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n \ttry {\r\n \t\tconst appointments = await db.appointment.findMany({\r\n \t\t\torderBy: [\r\n \t\t\t\t{\r\n"
                },
                {
                    "date": 1724786845245,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,150 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724787215303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,8 +35,9 @@\n \t}\r\n };\r\n \r\n export const getAppointment = async (id: string) => {\r\n+\r\n \ttry {\r\n \t\tconst patient = await db.appointment.findFirst({\r\n \t\t\twhere: {\r\n \t\t\t\tid: id,\r\n@@ -147,147 +148,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724787260258,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,153 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 500' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724787533784,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,151 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { AuthError } from 'next-auth';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointmentData: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\tif (error instanceof AuthError) {\r\n+\t\t\treturn { error: error.cause?.err?.message };\r\n+\t\t}\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1724787601833,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,11 +27,8 @@\n \t\t\t},\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n \t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n \t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n@@ -105,11 +102,8 @@\n \t\t};\r\n \t\treturn { success: true, data };\r\n \t} catch (error) {\r\n \t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n \t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n@@ -148,308 +142,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 500' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\tif (error instanceof AuthError) {\r\n-\t\t\treturn { error: error.cause?.err?.message };\r\n-\t\t}\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1724787642057,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,8 @@\n \r\n import { revalidatePath } from 'next/cache';\r\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n-import { AuthError } from 'next-auth';\r\n import { auth } from '@/auth';\r\n \r\n export const createAppointment = async (\r\n \tappointmentData: CreateAppointmentParams\r\n"
                },
                {
                    "date": 1726705595041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,14 +16,32 @@\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n \t\t}\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n \t\tconst { id } = await db.appointment.create({\r\n \t\t\tdata: {\r\n \t\t\t\t...data,\r\n \t\t\t\tuserId: appointmentData.userId,\r\n \t\t\t\tpatientId: appointmentData.patient,\r\n \t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t\t\t// identificationDocumentUrl: file?.$id\r\n+\t\t\t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t\t\t// \t: null,\r\n \t\t\t},\r\n \t\t});\r\n \t\treturn { success: true, createdId: id };\r\n \t} catch (error) {\r\n"
                },
                {
                    "date": 1726741778174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,163 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async ({\r\n+\tvocherImage,\r\n+\t...appointmentData\r\n+}: CreateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst { data, success } =\r\n+\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\r\n+\t\tif (!success) {\r\n+\t\t\treturn {\r\n+\t\t\t\terror: 'Invalid data',\r\n+\t\t\t};\r\n+\t\t}\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\tconst { id } = await db.appointment.create({\r\n+\t\t\tdata: {\r\n+\t\t\t\t...data,\r\n+\t\t\t\tuserId: appointmentData.userId,\r\n+\t\t\t\tpatientId: appointmentData.patient,\r\n+\t\t\t\tstatus: appointmentData.status,\r\n+\t\t\t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t\t\t// identificationDocumentUrl: file?.$id\r\n+\t\t\t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t\t\t// \t: null,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\treturn { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726741793910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -160,166 +160,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointmentData: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n-\r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t\t\t// identificationDocumentUrl: file?.$id\r\n-\t\t\t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t\t\t// \t: null,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1726742290906,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,12 @@\n \tvocherImage,\r\n \t...appointmentData\r\n }: CreateAppointmentParams) => {\r\n \ttry {\r\n-\t\tconst { data, success } =\r\n-\t\t\tCreateAppointmentSchema.safeParse(appointmentData);\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n \r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n"
                },
                {
                    "date": 1726742303556,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,10 @@\n \t\t\tvocherImage,\r\n \t\t\t...appointmentData,\r\n \t\t});\r\n \r\n+\t\tconsole.log(vocherImage)\r\n+\r\n \t\tif (!success) {\r\n \t\t\treturn {\r\n \t\t\t\terror: 'Invalid data',\r\n \t\t\t};\r\n"
                },
                {
                    "date": 1726769223760,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,13 +16,13 @@\n \t\t});\r\n \r\n \t\tconsole.log(vocherImage)\r\n \r\n-\t\tif (!success) {\r\n-\t\t\treturn {\r\n-\t\t\t\terror: 'Invalid data',\r\n-\t\t\t};\r\n-\t\t}\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n \r\n \t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n \t\t// let file;\r\n \t\t// if (identificationDocument) {\r\n@@ -35,22 +35,23 @@\n \r\n \t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n \t\t// }\r\n \r\n-\t\tconst { id } = await db.appointment.create({\r\n-\t\t\tdata: {\r\n-\t\t\t\t...data,\r\n-\t\t\t\tuserId: appointmentData.userId,\r\n-\t\t\t\tpatientId: appointmentData.patient,\r\n-\t\t\t\tstatus: appointmentData.status,\r\n-\t\t\t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t\t\t// identificationDocumentUrl: file?.$id\r\n-\t\t\t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t\t\t// \t: null,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\treturn { success: true, createdId: id };\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n \t} catch (error) {\r\n+\t\tconsole.log(error)\r\n \t\treturn { error: 'error 500' };\r\n \t}\r\n };\r\n \r\n"
                },
                {
                    "date": 1726769260588,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,168 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async ({\r\n+\tvocherImage,\r\n+\t...appointmentData\r\n+}: CreateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n+\r\n+\t\tconsole.log(vocherImage)\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error)\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726769271461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,171 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async ({\r\n+\tvocherImage,\r\n+\t...appointmentData\r\n+}: CreateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n+\r\n+\t\tconsole.log({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t})\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error)\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726770204408,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,171 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async ({\r\n+\tvocherImage,\r\n+\t...appointmentData\r\n+}: CreateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n+\r\n+\t\tconsole.log({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726770243646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,9 @@\n \r\n \t\tconsole.log({\r\n \t\t\tvocherImage,\r\n \t\t\t...appointmentData,\r\n-\t\t});\r\n+\t\t},success);\r\n \r\n \t\t// if (!success) {\r\n \t\t// \treturn {\r\n \t\t// \t\terror: 'Invalid data',\r\n@@ -168,511 +168,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async ({\r\n-\tvocherImage,\r\n-\t...appointmentData\r\n-}: CreateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t});\r\n-\r\n-\t\tconsole.log({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t})\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error)\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async ({\r\n-\tvocherImage,\r\n-\t...appointmentData\r\n-}: CreateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t});\r\n-\r\n-\t\tconsole.log(vocherImage)\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error)\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async ({\r\n-\tvocherImage,\r\n-\t...appointmentData\r\n-}: CreateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t});\r\n-\r\n-\t\tconsole.log(vocherImage)\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error)\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1726770277098,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,171 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async ({\r\n+\tvocherImage,\r\n+\t...appointmentData\r\n+}: CreateAppointmentParams) => {\r\n+\ttry {\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t});\r\n+\r\n+\t\tconsole.log({\r\n+\t\t\tvocherImage,\r\n+\t\t\t...appointmentData,\r\n+\t\t},success);\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726771947764,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,175 +168,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async ({\r\n-\tvocherImage,\r\n-\t...appointmentData\r\n-}: CreateAppointmentParams) => {\r\n-\ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t});\r\n-\r\n-\t\tconsole.log({\r\n-\t\t\tvocherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t},success);\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1726771988867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,19 +5,19 @@\n import { db } from '../db';\r\n import { auth } from '@/auth';\r\n \r\n export const createAppointment = async ({\r\n-\tvocherImage,\r\n+\tvoucherImage,\r\n \t...appointmentData\r\n }: CreateAppointmentParams) => {\r\n \ttry {\r\n \t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvocherImage,\r\n+\t\t\tvoucherImage,\r\n \t\t\t...appointmentData,\r\n \t\t});\r\n \r\n \t\tconsole.log({\r\n-\t\t\tvocherImage,\r\n+\t\t\tvoucherImage,\r\n \t\t\t...appointmentData,\r\n \t\t},success);\r\n \r\n \t\t// if (!success) {\r\n"
                },
                {
                    "date": 1726772056385,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,22 +4,15 @@\n import { CreateAppointmentSchema } from '../validation';\r\n import { db } from '../db';\r\n import { auth } from '@/auth';\r\n \r\n-export const createAppointment = async ({\r\n-\tvoucherImage,\r\n-\t...appointmentData\r\n-}: CreateAppointmentParams) => {\r\n+export const createAppointment = async (\r\n+\tappointment: CreateAppointmentParams\r\n+) => {\r\n \ttry {\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse({\r\n-\t\t\tvoucherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t});\r\n+\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointment);\r\n \r\n-\t\tconsole.log({\r\n-\t\t\tvoucherImage,\r\n-\t\t\t...appointmentData,\r\n-\t\t},success);\r\n+\t\tconsole.log(data, success);\r\n \r\n \t\t// if (!success) {\r\n \t\t// \treturn {\r\n \t\t// \t\terror: 'Invalid data',\r\n"
                },
                {
                    "date": 1726772080824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n export const createAppointment = async (\r\n \tappointment: CreateAppointmentParams\r\n ) => {\r\n \ttry {\r\n+\t\tconsole.log(appointment)\r\n \t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointment);\r\n \r\n \t\tconsole.log(data, success);\r\n \r\n"
                },
                {
                    "date": 1726773506693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,165 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointment: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconsole.log(appointment)\r\n+\t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n+\r\n+\t\tconsole.log(data, success);\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726783001888,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,168 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointment: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconsole.log(appointment)\r\n+\t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n+\r\n+\t\tconsole.log(data, success);\r\n+\r\n+\t\tconst fiorm = Object.fromEntries(appointment.voucherImage);\r\n+\t\tconsole.log(fiorm)\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\t// if (identificationDocument) {\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t// }\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                },
                {
                    "date": 1726783017189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,9 +13,9 @@\n \t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n \r\n \t\tconsole.log(data, success);\r\n \r\n-\t\tconst fiorm = Object.fromEntries(appointment.voucherImage);\r\n+\t\tconst fiorm = Object.fromEntries(appointment.voucherImage!);\r\n \t\tconsole.log(fiorm)\r\n \r\n \t\t// if (!success) {\r\n \t\t// \treturn {\r\n@@ -165,334 +165,4 @@\n \t} catch (error) {\r\n \t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n \t}\r\n };\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointment: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconsole.log(appointment)\r\n-\t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n-\r\n-\t\tconsole.log(data, success);\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n-'use server';\r\n-\r\n-import { revalidatePath } from 'next/cache';\r\n-import { CreateAppointmentSchema } from '../validation';\r\n-import { db } from '../db';\r\n-import { auth } from '@/auth';\r\n-\r\n-export const createAppointment = async (\r\n-\tappointment: CreateAppointmentParams\r\n-) => {\r\n-\ttry {\r\n-\t\tconsole.log(appointment)\r\n-\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointment);\r\n-\r\n-\t\tconsole.log(data, success);\r\n-\r\n-\t\t// if (!success) {\r\n-\t\t// \treturn {\r\n-\t\t// \t\terror: 'Invalid data',\r\n-\t\t// \t};\r\n-\t\t// }\r\n-\r\n-\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n-\t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n-\t\t// \tconst inputFile =\r\n-\t\t// \t\tidentificationDocument &&\r\n-\t\t// \t\tInputFile.fromBlob(\r\n-\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n-\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n-\t\t// \t\t);\r\n-\r\n-\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n-\r\n-\t\t// const { id } = await db.appointment.create({\r\n-\t\t// \tdata: {\r\n-\t\t// \t\t...data,\r\n-\t\t// \t\tuserId: appointmentData.userId,\r\n-\t\t// \t\tpatientId: appointmentData.patient,\r\n-\t\t// \t\tstatus: appointmentData.status,\r\n-\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n-\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n-\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n-\t\t// \t\t// \t: null,\r\n-\t\t// \t},\r\n-\t\t// });\r\n-\t\t// return { success: true, createdId: id };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getAppointment = async (id: string) => {\r\n-\tconst session = await auth();\r\n-\tif (!session!.user) return { error: 'error 401' };\r\n-\r\n-\ttry {\r\n-\t\tconst patient = await db.appointment.findFirst({\r\n-\t\t\twhere: {\r\n-\t\t\t\tid: id,\r\n-\t\t\t},\r\n-\t\t\tselect: {\r\n-\t\t\t\tid: true,\r\n-\t\t\t\tspecialty: true,\r\n-\t\t\t\tschedule: true,\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tif (!patient) return { error: 'Patient not found' };\r\n-\t\treturn {\r\n-\t\t\tsuccess: true,\r\n-\t\t\tdata: {\r\n-\t\t\t\t...patient,\r\n-\t\t\t},\r\n-\t\t};\r\n-\t} catch (error: any) {\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const getRecentAppointmentList = async () => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn { error: 'error 401' };\r\n-\t}\r\n-\ttry {\r\n-\t\tconst appointments = await db.appointment.findMany({\r\n-\t\t\torderBy: [\r\n-\t\t\t\t{\r\n-\t\t\t\t\tschedule: 'desc',\r\n-\t\t\t\t},\r\n-\t\t\t],\r\n-\t\t\tinclude: {\r\n-\t\t\t\tpatient: true, // All posts where authorId == 20\r\n-\t\t\t},\r\n-\t\t});\r\n-\t\tconst initialCounts = {\r\n-\t\t\tscheduledCount: 0,\r\n-\t\t\tpendingCount: 0,\r\n-\t\t\tcancelledCount: 0,\r\n-\t\t};\r\n-\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n-\t\t\tswitch (appointment.status) {\r\n-\t\t\t\tcase 'scheduled':\r\n-\t\t\t\t\tacc.scheduledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'pending':\r\n-\t\t\t\t\tacc.pendingCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t\tcase 'cancelled':\r\n-\t\t\t\t\tacc.cancelledCount++;\r\n-\t\t\t\t\tbreak;\r\n-\t\t\t}\r\n-\t\t\treturn acc;\r\n-\t\t}, initialCounts);\r\n-\t\tconst data = {\r\n-\t\t\ttotalCount: appointments.length,\r\n-\t\t\t...counts,\r\n-\t\t\tappointments,\r\n-\t\t};\r\n-\t\treturn { success: true, data };\r\n-\t} catch (error) {\r\n-\t\tconsole.log(error);\r\n-\t\treturn { error: 'error 500' };\r\n-\t}\r\n-};\r\n-\r\n-export const updateAppointment = async ({\r\n-\tappointmentId,\r\n-\tappointment,\r\n-}: UpdateAppointmentParams) => {\r\n-\tconst session = await auth();\r\n-\tconst userRole = session?.user?.role;\r\n-\tif (userRole !== 'admin') {\r\n-\t\treturn {\r\n-\t\t\terror: 'Unauthorize',\r\n-\t\t};\r\n-\t}\r\n-\ttry {\r\n-\t\tconst updatedAppointment = await db.appointment.update({\r\n-\t\t\twhere: { id: appointmentId },\r\n-\t\t\tdata: appointment,\r\n-\t\t});\r\n-\r\n-\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n-\r\n-\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n-\t\t// \ttype === 'schedule'\r\n-\t\t// \t\t? `Your appointment is confirmed for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n-\t\t// \t\t: `We regret to inform that your appointment for ${\r\n-\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n-\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n-\t\t// }.`;\r\n-\t\t//await sendSMSNotification(userId, smsMessage);\r\n-\t\t// console.log(updatedAppointment)\r\n-\t\trevalidatePath('/admin');\r\n-\t\treturn updatedAppointment;\r\n-\t} catch (error) {\r\n-\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n-\t}\r\n-};\r\n"
                },
                {
                    "date": 1726783148267,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,13 +10,13 @@\n ) => {\r\n \ttry {\r\n \t\tconsole.log(appointment)\r\n \t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n-\r\n+\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(appointment)\r\n \t\tconsole.log(data, success);\r\n \r\n \t\tconst fiorm = Object.fromEntries(appointment.voucherImage!);\r\n-\t\tconsole.log(fiorm)\r\n+\t\tconsole.log(formDataValidation)\r\n \r\n \t\t// if (!success) {\r\n \t\t// \treturn {\r\n \t\t// \t\terror: 'Invalid data',\r\n"
                },
                {
                    "date": 1726783200697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,13 +10,11 @@\n ) => {\r\n \ttry {\r\n \t\tconsole.log(appointment)\r\n \t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n-\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(appointment)\r\n+\t\t\r\n \t\tconsole.log(data, success);\r\n \r\n-\t\tconst fiorm = Object.fromEntries(appointment.voucherImage!);\r\n-\t\tconsole.log(formDataValidation)\r\n \r\n \t\t// if (!success) {\r\n \t\t// \treturn {\r\n \t\t// \t\terror: 'Invalid data',\r\n@@ -24,18 +22,20 @@\n \t\t// }\r\n \r\n \t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n \t\t// let file;\r\n-\t\t// if (identificationDocument) {\r\n+\t\tif (appointment.voucherImage) {\r\n+\t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(appointment)\r\n+\t\t\tconsole.log(formDataValidation)\r\n \t\t// \tconst inputFile =\r\n \t\t// \t\tidentificationDocument &&\r\n \t\t// \t\tInputFile.fromBlob(\r\n \t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n \t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n \t\t// \t\t);\r\n \r\n \t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n-\t\t// }\r\n+\t\t}\r\n \r\n \t\t// const { id } = await db.appointment.create({\r\n \t\t// \tdata: {\r\n \t\t// \t\t...data,\r\n"
                },
                {
                    "date": 1726783275502,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,10 @@\n \r\n \t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n \t\t// let file;\r\n \t\tif (appointment.voucherImage) {\r\n-\t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(appointment)\r\n+\t\t\tconst voucherImage = Object.fromEntries(appointment.voucherImage).blobFile;\r\n+\t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(voucherImage)\r\n \t\t\tconsole.log(formDataValidation)\r\n \t\t// \tconst inputFile =\r\n \t\t// \t\tidentificationDocument &&\r\n \t\t// \t\tInputFile.fromBlob(\r\n"
                },
                {
                    "date": 1726783299572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n \t\t// let file;\r\n \t\tif (appointment.voucherImage) {\r\n \t\t\tconst voucherImage = Object.fromEntries(appointment.voucherImage).blobFile;\r\n \t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(voucherImage)\r\n-\t\t\tconsole.log(formDataValidation)\r\n+\t\t\tconsole.log(formDataValidation.error())\r\n \t\t// \tconst inputFile =\r\n \t\t// \t\tidentificationDocument &&\r\n \t\t// \t\tInputFile.fromBlob(\r\n \t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n"
                },
                {
                    "date": 1726783815590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n \t\t// let file;\r\n \t\tif (appointment.voucherImage) {\r\n \t\t\tconst voucherImage = Object.fromEntries(appointment.voucherImage).blobFile;\r\n \t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(voucherImage)\r\n-\t\t\tconsole.log(formDataValidation.error)\r\n+\t\t\tconsole.log(formDataValidation, voucherImage)\r\n \t\t// \tconst inputFile =\r\n \t\t// \t\tidentificationDocument &&\r\n \t\t// \t\tInputFile.fromBlob(\r\n \t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n"
                },
                {
                    "date": 1726783987498,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,169 @@\n+'use server';\r\n+\r\n+import { revalidatePath } from 'next/cache';\r\n+import { CreateAppointmentSchema } from '../validation';\r\n+import { db } from '../db';\r\n+import { auth } from '@/auth';\r\n+\r\n+export const createAppointment = async (\r\n+\tappointment: CreateAppointmentParams\r\n+) => {\r\n+\ttry {\r\n+\t\tconsole.log(appointment)\r\n+\t\tconst { data, success } = CreateAppointmentSchema.omit({ voucherImage: true }).safeParse(appointment);\r\n+\t\t\r\n+\t\tconsole.log(data, success);\r\n+\r\n+\r\n+\t\t// if (!success) {\r\n+\t\t// \treturn {\r\n+\t\t// \t\terror: 'Invalid data',\r\n+\t\t// \t};\r\n+\t\t// }\r\n+\r\n+\t\t// Upload file ->  // https://appwrite.io/docs/references/cloud/client-web/storage#createFile\r\n+\t\t// let file;\r\n+\t\tif (appointment.voucherImage) {\r\n+\t\t\tconst voucherImage = [Object.fromEntries(appointment.voucherImage).blobFile];\r\n+\t\t\tconst formDataValidation = CreateAppointmentSchema.pick({ voucherImage: true }).safeParse(voucherImage)\r\n+\t\t\tconsole.log(formDataValidation.error, voucherImage)\r\n+\t\t// \tconst inputFile =\r\n+\t\t// \t\tidentificationDocument &&\r\n+\t\t// \t\tInputFile.fromBlob(\r\n+\t\t// \t\t\tidentificationDocument?.get('blobFile') as Blob,\r\n+\t\t// \t\t\tidentificationDocument?.get('fileName') as string\r\n+\t\t// \t\t);\r\n+\r\n+\t\t// \tfile = await storage.createFile(BUCKET_ID!, ID.unique(), inputFile);\r\n+\t\t}\r\n+\r\n+\t\t// const { id } = await db.appointment.create({\r\n+\t\t// \tdata: {\r\n+\t\t// \t\t...data,\r\n+\t\t// \t\tuserId: appointmentData.userId,\r\n+\t\t// \t\tpatientId: appointmentData.patient,\r\n+\t\t// \t\tstatus: appointmentData.status,\r\n+\t\t// \t\t// identificationDocumentId: file?.$id ? file.$id : null,\r\n+\t\t// \t\t// identificationDocumentUrl: file?.$id\r\n+\t\t// \t\t// \t? `${ENDPOINT}/storage/buckets/${BUCKET_ID}/files/${file.$id}/view??project=${PROJECT_ID}`\r\n+\t\t// \t\t// \t: null,\r\n+\t\t// \t},\r\n+\t\t// });\r\n+\t\t// return { success: true, createdId: id };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getAppointment = async (id: string) => {\r\n+\tconst session = await auth();\r\n+\tif (!session!.user) return { error: 'error 401' };\r\n+\r\n+\ttry {\r\n+\t\tconst patient = await db.appointment.findFirst({\r\n+\t\t\twhere: {\r\n+\t\t\t\tid: id,\r\n+\t\t\t},\r\n+\t\t\tselect: {\r\n+\t\t\t\tid: true,\r\n+\t\t\t\tspecialty: true,\r\n+\t\t\t\tschedule: true,\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tif (!patient) return { error: 'Patient not found' };\r\n+\t\treturn {\r\n+\t\t\tsuccess: true,\r\n+\t\t\tdata: {\r\n+\t\t\t\t...patient,\r\n+\t\t\t},\r\n+\t\t};\r\n+\t} catch (error: any) {\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const getRecentAppointmentList = async () => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn { error: 'error 401' };\r\n+\t}\r\n+\ttry {\r\n+\t\tconst appointments = await db.appointment.findMany({\r\n+\t\t\torderBy: [\r\n+\t\t\t\t{\r\n+\t\t\t\t\tschedule: 'desc',\r\n+\t\t\t\t},\r\n+\t\t\t],\r\n+\t\t\tinclude: {\r\n+\t\t\t\tpatient: true, // All posts where authorId == 20\r\n+\t\t\t},\r\n+\t\t});\r\n+\t\tconst initialCounts = {\r\n+\t\t\tscheduledCount: 0,\r\n+\t\t\tpendingCount: 0,\r\n+\t\t\tcancelledCount: 0,\r\n+\t\t};\r\n+\t\tconst counts = appointments.reduce((acc, appointment) => {\r\n+\t\t\tswitch (appointment.status) {\r\n+\t\t\t\tcase 'scheduled':\r\n+\t\t\t\t\tacc.scheduledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'pending':\r\n+\t\t\t\t\tacc.pendingCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cancelled':\r\n+\t\t\t\t\tacc.cancelledCount++;\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\treturn acc;\r\n+\t\t}, initialCounts);\r\n+\t\tconst data = {\r\n+\t\t\ttotalCount: appointments.length,\r\n+\t\t\t...counts,\r\n+\t\t\tappointments,\r\n+\t\t};\r\n+\t\treturn { success: true, data };\r\n+\t} catch (error) {\r\n+\t\tconsole.log(error);\r\n+\t\treturn { error: 'error 500' };\r\n+\t}\r\n+};\r\n+\r\n+export const updateAppointment = async ({\r\n+\tappointmentId,\r\n+\tappointment,\r\n+}: UpdateAppointmentParams) => {\r\n+\tconst session = await auth();\r\n+\tconst userRole = session?.user?.role;\r\n+\tif (userRole !== 'admin') {\r\n+\t\treturn {\r\n+\t\t\terror: 'Unauthorize',\r\n+\t\t};\r\n+\t}\r\n+\ttry {\r\n+\t\tconst updatedAppointment = await db.appointment.update({\r\n+\t\t\twhere: { id: appointmentId },\r\n+\t\t\tdata: appointment,\r\n+\t\t});\r\n+\r\n+\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n+\r\n+\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n+\t\t// \ttype === 'schedule'\r\n+\t\t// \t\t? `Your appointment is confirmed for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n+\t\t// \t\t: `We regret to inform that your appointment for ${\r\n+\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n+\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n+\t\t// }.`;\r\n+\t\t//await sendSMSNotification(userId, smsMessage);\r\n+\t\t// console.log(updatedAppointment)\r\n+\t\trevalidatePath('/admin');\r\n+\t\treturn updatedAppointment;\r\n+\t} catch (error) {\r\n+\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n+\t}\r\n+};\r\n"
                }
            ],
            "date": 1724111190276,
            "name": "Commit-0",
            "content": "'use server';\r\n\r\nimport { ID, Query } from 'node-appwrite';\r\nimport {\r\n\tDATABASE_ID,\r\n\tdatabases,\r\n\tAPPOINTMENT_COLLECTION_ID,\r\n} from '../appwite.config';\r\nimport { formatDateTime, parseStringify } from '../utils';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { CreateAppointmentSchema } from '../validation';\r\nimport { db } from '../db';\r\nimport { AuthError } from 'next-auth';\r\n\r\nexport const createAppointment = async (\r\n\tappointmentData: CreateAppointmentParams\r\n) => {\r\n\ttry {\r\n\t\tconst { data, success } = CreateAppointmentSchema.safeParse(appointmentData);\r\n\t\tconsole.log(data);\r\n\t\tif (!success) {\r\n\t\t\treturn {\r\n\t\t\t\terror: 'Invalid data',\r\n\t\t\t};\r\n\t\t}\r\n\t\tconst { id } = await db.patients.create({\r\n\t\t\tdata,\r\n\t\t});\r\n\t\treturn { success: true, createdId: id };\r\n\t} catch (error) {\r\n\t\tconsole.log(error);\r\n\t\tif (error instanceof AuthError) {\r\n\t\t\treturn { error: error.cause?.err?.message };\r\n\t\t}\r\n\t\treturn { error: 'error 500' };\r\n\t}\r\n};\r\n\r\nexport const getAppointment = async (appointmentId: string) => {\r\n\tconsole.log(appointmentId);\r\n\ttry {\r\n\t\tconst appointment = await databases.getDocument(\r\n\t\t\tDATABASE_ID!,\r\n\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n\t\t\tappointmentId\r\n\t\t);\r\n\t\tconsole.log(appointment);\r\n\r\n\t\treturn parseStringify(appointment);\r\n\t} catch (error) {\r\n\t\tconsole.error(\r\n\t\t\t'An error occurred while retrieving the existing patient:',\r\n\t\t\terror\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const getRecentAppointmentList = async () => {\r\n\ttry {\r\n\t\tconst appointments = await databases.listDocuments(\r\n\t\t\tDATABASE_ID!,\r\n\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n\t\t\t[Query.orderDesc('$createdAt')]\r\n\t\t);\r\n\r\n\t\tconst initialCounts = {\r\n\t\t\tscheduledCount: 0,\r\n\t\t\tpendingCount: 0,\r\n\t\t\tcancelledCount: 0,\r\n\t\t};\r\n\r\n\t\tconst counts = (appointments.documents as Appointment[]).reduce(\r\n\t\t\t(acc, appointment) => {\r\n\t\t\t\tswitch (appointment.status) {\r\n\t\t\t\t\tcase 'scheduled':\r\n\t\t\t\t\t\tacc.scheduledCount++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'pending':\r\n\t\t\t\t\t\tacc.pendingCount++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'cancelled':\r\n\t\t\t\t\t\tacc.cancelledCount++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t},\r\n\t\t\tinitialCounts\r\n\t\t);\r\n\r\n\t\tconst data = {\r\n\t\t\ttotalCount: appointments.total,\r\n\t\t\t...counts,\r\n\t\t\tdocuments: appointments.documents,\r\n\t\t};\r\n\r\n\t\treturn parseStringify(data);\r\n\t} catch (error) {\r\n\t\tconsole.error(\r\n\t\t\t'An error occurred while retrieving the recent appointments:',\r\n\t\t\terror\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const updateAppointment = async ({\r\n\tappointmentId,\r\n\tappointment,\r\n\ttype,\r\n}: UpdateAppointmentParams) => {\r\n\ttry {\r\n\t\tconst updatedAppointment = await databases.updateDocument(\r\n\t\t\tDATABASE_ID!,\r\n\t\t\tAPPOINTMENT_COLLECTION_ID!,\r\n\t\t\tappointmentId,\r\n\t\t\tappointment\r\n\t\t);\r\n\r\n\t\tif (!updatedAppointment) throw new Error('Appointment not found');\r\n\r\n\t\t// const smsMessage = `Greetings from CarePulse. ${\r\n\t\t// \ttype === 'schedule'\r\n\t\t// \t\t? `Your appointment is confirmed for ${\r\n\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n\t\t// \t\t  } with Dr. ${appointment.primaryPhysician}`\r\n\t\t// \t\t: `We regret to inform that your appointment for ${\r\n\t\t// \t\t\t\tformatDateTime(appointment.schedule!, timeZone).dateTime\r\n\t\t// \t\t  } is cancelled. Reason:  ${appointment.cancellationReason}`\r\n\t\t// }.`;\r\n\t\t//await sendSMSNotification(userId, smsMessage);\r\n\r\n\t\trevalidatePath('/admin');\r\n\t\treturn parseStringify(updatedAppointment);\r\n\t} catch (error) {\r\n\t\tconsole.error('An error occurred while scheduling an appointment:', error);\r\n\t}\r\n};\r\n"
        }
    ]
}